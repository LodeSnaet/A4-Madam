{% extends '_shared/_layout.twig' %}

{% block main %}

  <section class="c-productdetail">
    {% import '_macros/images.twig' as img %}

    <div class="container">
      <div class="row g-4">
        <div class="col-12 col-lg-3">
          <div class="c-productdetail__btn">
            <a href="/shop" class="c-btn">Back to Overview</a>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <div class="c-productdetail__imgs">
            {{ img.responsiveImage(product.productPhotos.limit(3), {
              aspectRatio: '9:14',
              quality: 80,
              transformHandle: 'img2Webp',
              onlyFirst: false
            }) }}
          </div>
        </div>

        <div class="col-12 col-lg-5">
          <div class="c-productdetail__info">
            <div class="c-productdetail__title">
              {% include '_components/_subtitle.twig' with {
                title: product.collection.one().title ?? '',
                description: product.title ?? '',
                additionalClasses: 'c-shop__title'
              } %}


              {% include '_components/_productform' with {products: product.variants} %}

            </div>

            <div class="c-productdetail__table">
              <p class="c-productdetail__description">{{ product.description }}</p>

              <div class="c-productdetail__condition">
                {% set fieldHandles = ['colour', 'material', 'condition', 'certificate'] %}

                {% for handle in fieldHandles %}
                  {% set loopIndex = loop.index %}

                  {# Manually insert the Size item at the second position #}
                  {% if loopIndex == 2 %}
                    {% set variant = product.defaultVariant %}
                    {% if variant %}
                      <div class="c-productdetail__item">
                        <p class="u-italic">Size</p>
                        <p>{{ variant.length }} x {{ variant.width }} x {{ variant.height }}</p>
                      </div>
                    {% endif %}
                  {% endif %}

                  {# Render the fields from your `fieldHandles` array #}
                  {% set field = craft.app.fields.getFieldByHandle(handle) %}

                  {# Check if the field is defined, not if it's empty #}
                  {% if field and product[handle] is defined %}
                    <div class="c-productdetail__item">
                      <p class="u-italic">{{ field.name }}</p>
                      <p>
                        {% if handle == 'certificate' %}
                          {{ product[handle] ? 'Yes' : 'No' }}
                        {% else %}
                          {% for title in product[handle].all() %}
                            {{ title.title }}{% if not loop.last %}, {% endif %}
                          {% endfor %}
                        {% endif %}
                      </p>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  {% set layoutEntry = craft.entries.section('productDetail').one() %}

  {% for section in layoutEntry.newSection %}
    {% if section.type.handle == 'blogPosts' %}
      {% include '_sections/blog.twig' with section %}
    {% elseif section.type.handle == 'newProducts' %}
      {% include '_sections/newproducts.twig' with section %}
    {% elseif section.type.handle == 'review' %}
      {% include '_sections/review.twig' with section %}
    {% elseif section.type.handle == 'email' %}
      {% include '_sections/email.twig' with section %}
    {% elseif section.type.handle == 'featuredCollection' %}
      {% include '_sections/featured.twig' with section %}
    {% endif %}
  {% endfor %}

{% endblock %}
